# Architecture Update: src/ Directory Structure

## Key Changes

The project has been updated to use modern TanStack Start conventions with a `src/` directory structure:

### Directory Structure Changes
- **OLD**: `app/` directory for routes, components, and lib
- **NEW**: `src/` directory for all source code

### Specific Path Changes
```
app/routes/          → src/routes/
app/components/      → src/components/
app/lib/            → src/lib/
app/server/         → src/server/
app/client.tsx      → src/client.tsx
app/router.tsx      → src/router.tsx
app/routeTree.gen.ts → src/routeTree.gen.ts
```

### Configuration Updates
- **tsr.config.json**: Now points to `./src/routes` and generates to `./src/routeTree.gen.ts`
- **Build Tool**: Using Nitro v2 server preset (configured in `vite.config.ts`)
- **Server Functions**: Now in `src/server/` using Nitro v2 conventions with `defineEventHandler`
- **Styling**: Added Tailwind CSS via `@tailwindcss/vite` plugin

### Server Function Changes
- **OLD Pattern**: TanStack Start loaders/actions in route files
- **NEW Pattern**: Nitro v2 server functions in `src/server/` directory
- **Handler Pattern**: Use `defineEventHandler` from Nitro/h3
- **APIs**: `readBody`, `getQuery`, `setResponseHeader`, `sendStream` from h3

### Server Endpoint Structure
```
src/server/
  /api/
    /import/
      start.ts         # POST /api/import/start
      stream.ts        # GET /api/import/stream (SSE)
      commit.ts        # POST /api/import/commit
    /ai/
      summarize.ts     # POST /api/ai/summarize
    invite.exchange.ts
    turnstile.verify.ts
  /calendar/
    [ws].ics.ts        # GET /calendar/:ws.ics
  /webhooks/
    github.ts          # POST /webhooks/github
```

### What Remains the Same
- `/convex/` directory structure unchanged
- `vite.config.ts` at root (though now includes Nitro v2 plugin)
- `tsr.config.json` at root
- `netlify.toml` at root
- Package.json scripts remain the same

## Update Instructions for All Tasks

**For all tasks that reference file paths**:
1. Replace `app/` with `src/` in all file paths
2. Replace `app.config.ts` references with `vite.config.ts` when discussing server configuration
3. Update server function references to use Nitro v2 patterns
4. Update any examples that use TanStack Start loaders/actions in routes to clarify they should use server functions in `src/server/` instead

**For tasks involving server functions/API routes**:
- Clarify that server functions go in `src/server/` directory
- Use Nitro v2 handler pattern: `export default defineEventHandler(async (event) => { ... })`
- Use h3 utilities: `readBody(event)`, `getQuery(event)`, `setResponseHeader(event, ...)`, `sendStream(event, stream)`

**For tasks involving routing**:
- Routes still use file-based routing in `src/routes/`
- Route tree is still auto-generated at `src/routeTree.gen.ts`
- Same route naming conventions (e.g., `tasks.$taskId.tsx` for dynamic routes)

**For tasks involving components/UI**:
- Components now in `src/components/`
- Utilities/helpers in `src/lib/`
- Client entry at `src/client.tsx`
- Router instance at `src/router.tsx`
